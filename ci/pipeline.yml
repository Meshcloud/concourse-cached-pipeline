---
resource_types:
- name: git-branch-heads
  type: docker-image
  source:
    repository: vito/git-branch-heads-resource

resources:
# Repos
- name: github-master
  type: git
  source: &github-master # YAML anchor ;-)
    uri: https://github.com/Meshcloud/concourse-cached-pipeline.git
    branch: master

jobs:
- name: cache-master
  plan: 
  - get: repo
    resource: github-master
    trigger: true
  - aggregate:
    - task: cache-a
      file: repo/ci/cache-a.yml
      params:
        BASE_URL: {{artifacts-url}}
      output_mapping:
        cache: cache-a
    - task: cache-b
      file: repo/ci/cache-b.yml
      params:
        BASE_URL: {{artifacts-url}}
      output_mapping:
        cache: cache-b

- name: build-master
  plan:
  - get: repo
    passed: [cache-master]
    resource: github-master
    trigger: true